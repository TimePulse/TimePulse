- set_headline  "Listing Users' Hours"
= javascript_include_tag "/flot/jquery.flot.js"
= javascript_include_tag "/flot/jquery.flot.symbol.js"
= javascript_include_tag "/flot/jquery.flot.axislabels.js"

.button-wrap
  %div.button.radius#all-user-hours-btn
    All
  %div.button.radius#total-user-hours-btn
    Total
  %div.button.radius#billable-user-hours-btn
    Billable
  %div.button.radius#unbillable-user-hours-btn
    Unbillable

= form_tag hours_reports_path do
  %div.input-container
    %p Start Date
    %input.american_date_entry#start-datepicker{:type => "text", :name => "start_date", :value => @start_date}
  %div.input-container
    %p End Date
    %input.american_date_entry#end-datepicker{:type => "text", :name => "end_date", :value => @end_date}
  = submit_tag "Submit", :id => 'datepicker-submit-btn'

= tabbed_panel do |tp|
  = tp.add_tab('Table') do
    -#= will_paginate @unpaid_invoices
    %table.listing
      %tr.week_row
        %td
        - @sundays.each do |sun|
          %td
            %h2= 'Week ending ' + sun
      - @users.each do |u|
        %tr.user_row
          %td
            %h2= u.name
          - @sundays.each do |sunday|
            %td
              %div.billable= WorkUnitQuery.new(u,sunday,'billable').hours
              %div.unbillable= WorkUnitQuery.new(u,sunday,'unbillable').hours
              %div.total= WorkUnitQuery.new(u,sunday,'total').hours
  = tp.add_tab('Graph') do
    #placeholder{ :style => 'width:850px;height:450px;' }

:javascript
  $(document).ready(function () {
    function convertToDate(timestamp) {
        var newDate = new Date(timestamp);
        var dateString = newDate.getMonth();
        var monthName = getMonthName(dateString);

        return monthName;
    }

    var totalHoursDataset = #{hours_reports_data(@users,@sundays,'total')};
    console.log(totalHoursDataset);
    var labels = [];
    var users = #{get_names(@users)};
    var colors = ["blue","#009900","deeppink","#00CCFF","#6600CC","magenta","orange","darkgray","#66FF66"];
    var sundays = #{@sundays};
    var xTicks = #{xaxis_labels(@sundays)};

    for (var i = 0; i < users.length; i++) {
      labels.push(
        { label: users[i],
          data: totalHoursDataset[i],
          points: { symbol: "circle", fillColor: colors[i] },
          color: colors[i] }
      );
    }
    $.plot("#placeholder", labels, {
      series: {lines:{show: true}},
      xaxis: {
        axisLabel: 'Week endings',
        axisLabelUseCanvas: true,
        axisLabelFontSizePixels: 12,
        axisLabelFontFamily: 'sans-serif',
        axisLabelPadding: 30,
        ticks: xTicks,
        tickColor: 'transparent'
      },
      yaxis: {
        axisLabel: 'Number of Work Units',
        axisLabelUseCanvas: true,
        axisLabelFontSizePixels: 12,
        axisLabelFontFamily: 'sans-serif',
        axisLabelPadding: 30
      },
      grid: {
        hoverable: true,
        borderWidth: 1
      },
      legend: {
        labelBoxBorderColor: 'none',
        position: 'left'
      }
    });
  });